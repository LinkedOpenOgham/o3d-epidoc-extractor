<html>
<head><title>Ogham Mapview</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
<script src="https://unpkg.com/osmtogeojson@2.2.12/osmtogeojson.js"></script>
  <script src="js/leaflet.polylinedecorator.js"></script>
  <script src="js/wicket.js" type="text/javascript"></script>
  <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
     <script src="js/leaflet.fullscreen.js"></script>
	 <script src="js/leaflet-search.js"></script>
	 <script src="data/oghamireland.js"></script>
   <script src="js/leaflet_legend.js"></script>
      <script src="js/leaflet_easyprint.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  
<script>
var prefixlist="@prefix owl: <http://www.w3.org/2002/07/owl#> .\n @prefix foaf: <http://xmlns.com/foaf/0.1/> .\n @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> . @prefix xml: <http://www.w3.org/XML/1998/namespace> . \n @prefix xsd: <http://www.w3.org/2001/XMLSchema#> . \n @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> . \n"
var overlayMaps=[]
var ttlExport="";
var minMapZoom=2;
var first=true;
var resultLayerCollection=[]
var loaded=false;

</script>

</head>
<body>
<h2 align="center">Ogham Mapview</h2>

<div id="mapid" style="height:80%;border:5px solid black;">
<script>
var wikidataToOSMMap={}
var osmToWikidataMap={}
	var map = L.map('mapid',{fullscreenControl: true,fullscreenControlOptions: {position: 'topleft'}}).setView([53.3425,-6.265833], 6).locate({setView: true, maxZoom: 22});
	map.addControl( new L.Control.Search({
		url: 'https://nominatim.openstreetmap.org/search?format=json&q={s}',
		jsonpParam: 'json_callback',
		propertyName: 'display_name',
		propertyLoc: ['lat','lon'],
		marker: L.circleMarker([0,0],{radius:30}),
		autoCollapse: true,
		autoType: false,
		minLength: 2
	}));
       
		
	var layer=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
});

function reloadLayer(){
	console.log("reloadLayer");
	clearMap();
	addOfficialLayer();
}

function addOfficialLayer(){

	var officiallayer=L.geoJSON(oghamireland,{
	filter: function(feature,layer){
			 console.log($("input:radio[name='mode']:checked").val())
	 if(feature.properties["containsWolfName"] && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="wolf" || first)){
			return true;
	 }else if(feature.properties["containsBattleName"] && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="Battle" || first)){
			return true;
	 }else if(feature.properties["containsGodLughName"] && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="godlugh" || first)){
			return true;
	 }else if(feature.properties["persons"].length==0 && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="NoPerson" || first)){
			return true;
	 }else if(feature.properties["fatherson"].length>0 && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="FatherSon" || first)){
			return true;
	 }else if(feature.properties["tribes"].length>0 && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="Tribe" || first)){
			return true;
	 }
	 if($("input:radio[name='mode']:checked").val()=="all" || first)
		return true;
	return false;
	},
onEachFeature: function (feature, layer) {
	 var popup="Ogham Data<br/><ul>"
	 for(prop in feature.properties){
		if(!prop.startsWith("contains") && feature.properties[prop]!=""){
				if(prop=="image"){
					if(feature.properties[prop].includes("titus")){
						var link=feature.properties[prop].replace(".html",".jpg").replace(".htm",".jpg").replace("html","l")
						var substr=link.substring(link.lastIndexOf('/')+1,link.indexOf('x'))
						link=link.substring(0,link.lastIndexOf('/')+1)+substr+"/"+link.substring(link.lastIndexOf('/')+1)
										popup+="<li>"+prop+" - <a href=\""+link+"\" target=\"_blank\"><img src=\""+link+"\" width=\"30\" height=\"30\" /></a></li>"
					}else{
										popup+="<li>"+prop+" - <a href=\""+feature.properties[prop]+"\" target=\"_blank\">"+feature.properties[prop]+"</a></li>"
					}
	
				}else if(prop=="persons"){
						popup+="<li><b>Persons</b><ul>"
						for(obj in feature.properties[prop]){
							popup+="<li>"+feature.properties[prop][obj]+"</li>"
						}
						popup+="</ul></li>"
				}else if(prop=="fatherson"){
						popup+="<li><b>Father - Son</b><ul>"
						for(obj in feature.properties[prop]){
							popup+="<li>"+feature.properties[prop][obj]["son"]+" is son of "+feature.properties[prop][obj]["father"]+"</li>"
						}
						popup+="</ul></li>"
					}else if(prop=="tribes"){
						popup+="<li><b>Tribes</b><ul>"
						for(obj in feature.properties[prop]){
							popup+="<li>"+feature.properties[prop][obj]["person"]+" is member of tribe "+feature.properties[prop][obj]["tribe"]+"</li>"
						}
						popup+="</li></ul>"
					}else{
								 	popup+="<li>"+prop+" - "+feature.properties[prop]+"</li>"
				}

		}
	 }
	 popup+="</ul>"
	 console.log($("input:radio[name='mode']:checked").val())
	 if(feature.properties["containsWolfName"] && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="wolf" || first)){
			 var greyIcon = new L.Icon({
                                        iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
			layer.setIcon(greyIcon);
	 }else if(feature.properties["containsBattleName"] && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="Battle" || first)){
					 var greyIcon = new L.Icon({
                                        iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
			layer.setIcon(greyIcon);
	 }else if(feature.properties["containsGodLughName"] && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="godlugh" || first)){
							 var greyIcon = new L.Icon({
                                        iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
			layer.setIcon(greyIcon);
	 }else if(feature.properties["persons"].length==0 && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="NoPerson" || first)){
							 var greyIcon = new L.Icon({
                                        iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
			layer.setIcon(greyIcon);
	 }else if(feature.properties["fatherson"].length>0 && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="FatherSon" || first)){
							 var greyIcon = new L.Icon({
                                        iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
			layer.setIcon(greyIcon);
	 }else if(feature.properties["tribes"].length>0 && ($("input:radio[name='mode']:checked").val()=="all" || $("input:radio[name='mode']:checked").val()=="Tribe" || first)){
							 var greyIcon = new L.Icon({
                                        iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png',
                                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                        iconSize: [25, 41],
                                        iconAnchor: [12, 41],
                                        popupAnchor: [1, -34],
                                        shadowSize: [41, 41]
                                    });
			layer.setIcon(greyIcon);
	 }

         layer.bindPopup(popup);
     }}).addTo(map);
	 		first=false;
	overlayMaps.push(officiallayer);
	resultLayerCollection.push(officiallayer);
}

function clearMap() {
	for(i in resultLayerCollection){
		//if(resultLayerCollection[i]._path != undefined) {
            try {
                map.removeLayer(resultLayerCollection[i]);
            }
            catch(e) {
                console.log("problem with " + e + map._layers[i]);
            }
        //}
	}
    for(i in map._layers) {
        if(map._layers[i]._path != undefined) {
            try {
                map.removeLayer(map._layers[i]);
            }
            catch(e) {
                console.log("problem with " + e + map._layers[i]);
            }
        }
    }
	/*for(marker in markercollection){
		map.removeLayer(markercollection[marker])
	}
	markercollection=[]
        for(decorator in decorators){
		map.removeLayer(decorators[decorator])
	}
	decorators=[]*/
}

addOfficialLayer();
		var wmsLayer = L.tileLayer.wms('https://sgx.geodatenzentrum.de/wms_topplus_web_open', {
layers: 'web',
format: 'image/png',
 transparent: true,
attribution: '&copy; Bundesamt f&uuml;r Kartographie und Geod&auml;sie 2017, <a href="http://sg.geodatenzentrum.de/web_public/Datenquellen_TopPlus_Open.pdf">Datenquellen</a>'
});
	var baseMaps = {
		"BKG": wmsLayer,
        "OSM": layer
	};
	baseMaps["OSM"].addTo(map);
	L.control.scale({
	position: 'bottomright',
	imperial: false
}).addTo(map);
var layercontrol=L.control.layers(baseMaps,overlayMaps).addTo(map);
loaded=true;
</script>
</div>
<fieldset>
    <input type="radio" id="all" name="mode" value="all" onclick="reloadLayer()">
    <label for="all">All</label> 
    <input type="radio" id="wolf" name="mode" value="wolf" onclick="reloadLayer()">
    <label for="wolf" style="background-color:gray">Wolf</label> 
    <input type="radio" id="godlugh" name="mode" value="godlugh" onclick="reloadLayer()">
    <label for="godlugh" style="background-color:yellow">God Lugh</label>
    <input type="radio" id="battle" name="mode" value="Battle" onclick="reloadLayer()">
    <label for="battle" style="background-color:green">Battle</label> 
	<input type="radio" id="noperson" name="mode" value="NoPerson" onclick="reloadLayer()">
    <label for="noperson" style="background-color:red">No persons described</label> 
	<input type="radio" id="fahterson" name="mode" value="FatherSon" onclick="reloadLayer()">
    <label for="fatherson" style="background-color:orange">FatherSon</label> 
	<input type="radio" id="tribe" name="mode" value="Tribe" onclick="reloadLayer()">
    <label for="tribe" style="background-color:black;color:white">Tribe</label> 
  </fieldset>
</body>
</html>
